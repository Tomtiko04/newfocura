generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String          @id @default(cuid())
  email               String          @unique
  passwordHash        String?
  name                String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  googleId            String?         @unique
  appleId             String?         @unique
  antiGoals           String[]
  energyChronotype    String          @default("morning")
  lifeSeason          String          @default("sustainability")
  onboardingCompleted Boolean         @default(false)
  reliabilityScore    Int             @default(3)
  weekdayFocusHours   Float           @default(2.0)
  weekendFocusHours   Float           @default(4.0)
  dailyBioSyncs       DailyBioSync[]
  energyPatterns      EnergyPattern[]
  futureLetters       FutureLetter[]
  goals               Goal[]
  momentumScores      MomentumScore[]
  reflections         Reflection[]
  schedules           Schedule[]
  snaps               Snap[]
  tasks               Task[]
  yearlyGoals         YearlyGoal[]
}

model Goal {
  id                  String   @id @default(cuid())
  userId              String
  title               String
  description         String?
  deadline            DateTime
  feasibilityScore    Float?
  feasibilityAnalysis String?
  strategicPivot      String?
  status              String   @default("active")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model YearlyGoal {
  id                 String    @id @default(cuid())
  userId             String
  title              String
  why                String?
  feasibilityScore   Float?
  feasibilityComment String?
  strategicPivot     String?
  priorityOrder      Int?
  status             String    @default("draft")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  endDate            DateTime?
  startDate          DateTime?
  estimatedHours     Float?
  impactScore        Float?
  priorityBucket     String?
  suggestedQuarter   Int?
  skillLevel         String?   @default("beginner")
  aiBaselinePrompt   String?
  baselineMetric     String?
  baselineValue      String?
  failureRisk        String?
  recoveryStrategy   String?
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([suggestedQuarter])
}

model Task {
  id                      String    @id @default(cuid())
  userId                  String
  goalId                  String?
  title                   String
  description             String?
  priority                Int       @default(3)
  energyRequirement       String
  implementationIntention String
  status                  String    @default("pending")
  scheduledTime           DateTime?
  scheduledEnergyWindow   String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  completedAt             DateTime?
  subtasks                Subtask[]
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([scheduledTime])
}

model Subtask {
  id               String    @id @default(cuid())
  taskId           String
  title            String
  durationEstimate Int
  status           String    @default("pending")
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  task             Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
}

model Reflection {
  id        String   @id @default(cuid())
  userId    String
  content   String
  date      DateTime @default(now())
  vectorId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([date])
}

model Snap {
  id               String   @id @default(cuid())
  userId           String
  imageUrl         String
  extractedData    Json
  vectorSyncStatus String   @default("pending")
  vectorId         String?
  createdAt        DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Schedule {
  id            String   @id @default(cuid())
  userId        String
  date          DateTime @default(now())
  tasks         Json
  energyWindows Json
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model EnergyPattern {
  id                String   @id @default(cuid())
  userId            String
  chronotype        String?
  peakEnergyStart   String?
  peakEnergyEnd     String?
  lowEnergyStart    String?
  lowEnergyEnd      String?
  averageSleepHours Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model DailyBioSync {
  id             String   @id @default(cuid())
  userId         String
  date           DateTime @default(now())
  sleepTime      DateTime
  wakeTime       DateTime
  initialFocus   Int
  actualPeaks    Json?
  sleepDebt      Float?
  sleepInertia   Int?
  energyBaseline Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model MomentumScore {
  id              String   @id @default(cuid())
  userId          String
  date            DateTime @default(now())
  consistency     Boolean
  energyAlignment Float
  recovery        Float
  overallScore    Float
  createdAt       DateTime @default(now())
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model FutureLetter {
  id        String   @id @default(cuid())
  userId    String
  content   String
  openAt    DateTime
  isOpened  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}
